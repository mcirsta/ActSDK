#**************************************************************************
#                                                                         *
#   PROJECT     : MIPS port for UCOS-II                                   *
#                                                                         *
#   MODULE      : MakeFile                                                *
#                                                                         *
#   AUTHOR      :                                                         *
#                                                                         *
#   PROCESSOR   : MIPS 4KEc (32 bit RISC) - Actions board                 *
#                                                                         *
#   Tool-chain  :  Cygnus                                                 *
#                                                                         *
#   DESCRIPTION :                                                         *
#   Makefile used for building application.                               *
#                                                                         *
#   The default target (all) builds application in two formats :          *
#   *.elf : Image in ELF format.                                          *
#   *.rec : Image in S-record format.                                     *
#                                                                         *
#   The linker also generates a MAP file "*.map".                         *
#                                                                         *
#   Other targets are :                                                   *
#   clean :    Deletes all files generated by makefile.                   *
#   depend :   Builds dependency file.                                    *
#                                                                         *
#*************************************************************************/
CC        = sde-gcc
LD        = sde-ld

# **********************************************
# Endianness
# **********************************************
ENDIAN  = EL
ifeq ($(ENDIAN),EL)
OFORMAT = -EL
else
OFORMAT = -EB
endif

# **********************************************
# Type of Processor & Board
# **********************************************
Processor = mips

# **********************************************
# Directories
# **********************************************
CURDIR = $(shell /bin/pwd)/
ROOT   = $(CURDIR)/../../../
SDKROOT := $(shell $(ROOT)/config/config.make)
OUTPUT    = $(SDKROOT)/case/images/apps/welcome.bin
LIBDIR :=$(SDKROOT)/psp_rel/lib/

include $(SDKROOT)/psp_rel/config/config.cfg
include $(SDKROOT)/case/include/case.xn 
            
MODULE_ADDR = $(LCM_VADDR) 


SDKINCDIR    = $(ROOT)/include
SDKINC    = $(ROOT)/inc

# **********************************************
# DRV Lib files
# **********************************************
LIBOBJ = $(LIBDIR)/usb.a $(LIBDIR)/syscall_api.a $(LIBDIR)/kmodule_api.a 


# ***********************************************
# complile flags
# ***********************************************
INCLUDE   = -I$(SDKINCDIR) \
            -I$(SDKINC) \
            -I./../include \
            -I./../lcd_lib/$(LCM_TYPE) \

CC_OPTS   = -O0 -Wall -Wno-unknown-pragmas -D_IN_WELCOME_ -G0 $(INCLUDE) -fsigned-char -mtune=4kec -mips32r2  $(OFORMAT) 
CC_OPTS_N_G0   = -O0 -Wall -Wno-unknown-pragmas -D_IN_WELCOME_  $(INCLUDE) -fsigned-char -mtune=4kec -mips32r2  $(OFORMAT) 
LD_OPTS_1   = -G0  -T welcome.xn  $(OFORMAT) 
LD_OPTS_2   = -o  welcome.exe -Map welcome.map


all: display_logo.c 
	$(CC) $(CC_OPTS)  -c display_logo.c  -o display_logo.o

	$(CC) $(CC_OPTS)  -c modify_info.c  -o modify_info.o	
	$(CC) $(CC_OPTS)  -c ../lcd_yuv2rgb.c  -o lcd_yuv2rgb.o
	$(CC) $(CC_OPTS)  -c ../lcd_inner.c  -o lcd_inner.o	
	$(CC) $(CC_OPTS)  -c ../lcd_lib/$(LCM_TYPE)/lcd_hw.c  -o lcd_hw.o		
	$(CC) $(CC_OPTS)  -c ../lcd_backlight.c  -o lcd_backlight.o

	$(CC) $(CC_OPTS_N_G0)  -c switchadfu.c  -o switchadfu.o	

	$(LD) $(LD_OPTS_1)  lcd_inner.o lcd_hw.o lcd_yuv2rgb.o  lcd_backlight.o display_logo.o   modify_info.o switchadfu.o  $(LIBOBJ) $(LD_OPTS_2)

	sde-objdump -D welcome.exe > welcome.lst
	sde-objcopy -O binary welcome.exe welcome.bin

	@echo ----------------------------------------
	@echo ¹§Ï²Äú,±àÒë³É¹¦£¡£¨Ð¡¶Ë£©

	cp welcome.bin $(OUTPUT)
	rm *.o *.exe *.bin *.lst ../lcd_lib/$(LCM_TYPE)/*.o 
clean:
	rm  -f *.o  *.exe *.lst *.bin $(OUTPUT)

